namespace Front.API.Controllers
{
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using global::Core.BC.Domain.Entities.checklist;
    using global::Core.BC.Domain.Entities.checklist.Commands;
    using global::Core.BC.Domain.Entities.checklist.interfaces;
    using Interanet.Commons.Core.Shared.Interfaces;
    using Interanet.Commons.Core.Shared.Messages;
    using Interanet.Commons.Front.Shared.Base;
    using MediatR;
    using Microsoft.AspNetCore.Authorization;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.Extensions.Logging;
    using Swashbuckle.AspNetCore.Annotations;

    [Route("~/checklist")]
    [ApiExplorerSettings(GroupName = @"checklist")]
    [SwaggerTag("Api da Empresa.")]
    public class ChecklistController : DefaultControllerAbstract<ChecklistModel>
    {
        public ChecklistController(
            IAppService<ChecklistModel> service,
            ILogger<ChecklistModel> logger,
            INotificationHandler<Notification> notification)
            : base(service, logger, notification)
        {
            service.EnableUserAcl = true;
        }

        [HttpPost]
        [SwaggerOperation(
        Summary = "Insere  um novo registro",
        Description = "")]
        public async Task<IActionResult> Create(ChecklistBaseCommand cmd)
        {
            var response = await this.service.Create(cmd);

            return this.Response(response.IsValid ? response.Data : null, null, null);

        }
        
        [HttpPut]
        [SwaggerOperation(
        Summary = "Atualiza um registro",
        Description = ".")]
        public async Task<IActionResult> Update(ChecklistModel cmd)
        {

            var app = (IchecklistServices)this.service;
            var response = await app.Update(cmd);

            return this.Response(true);
        }

        [HttpPost]
        [Route("search")]
        [SwaggerOperation(
       Summary = "Pesquisar",
       Description = "Pesquisa de forma paginada ...")]
        [SwaggerResponse(404, "Não há nenhum objeto cadastrado para este recurso.", null)]
        [SwaggerResponse(200, "Ação realizada com sucesso.", typeof(ResponsePaginated<List<ChecklistModel>>))]
        public virtual async Task<IActionResult> Search(
           [FromBody] ChecklistListCommand cmd,
           [FromHeader] int pageSize = 10,
           [FromHeader] int page = 1,
           [FromHeader] string order = "asc",
           [FromHeader] string columnOrder = "Title"
           )
        {
            cmd.PageSize = pageSize;
            cmd.Order = order;
            cmd.ColumnOrder = columnOrder;
            var app = (IchecklistServices)this.service;
            var response = await app.Search(cmd);
            return this.Response(response.IsValid ? response : null, nameof(this.GetById), null);
        }

        [HttpGet]
        [Route("uid/{uid}")]
        [AllowAnonymous]
        [SwaggerOperation(
      Summary = "Busca o checklist por uid",
      Description = ".")]
        public async Task<IActionResult> Uid(Guid uid)
        {
            var app = (IchecklistServices)this.service;
            var response = app.Uid(uid);
            var name = app.GetConfigName(response.ChecklistConfigUid);

            var newResponse = new
            {
                response = response,
                name = name.ToUpper()
            };

            return this.Response(newResponse, null);
        }

        [HttpGet]
        [Route("parent/{uid}")]
        [SwaggerOperation(
       Summary = "Pesquisar",
       Description = "Pesquisa de forma paginada ...")]
        [SwaggerResponse(404, "Não há nenhum objeto cadastrado para este recurso.", null)]
        [SwaggerResponse(200, "Ação realizada com sucesso.", typeof(ResponsePaginated<List<ChecklistModel>>))]
        public IActionResult ByPerson(
           [FromHeader] Guid businessUid,
           [FromRoute] Guid uid,
           [FromHeader] string order = "asc",
           [FromHeader] string columnOrder = "name"
           )
        {
            var cmd = new ChecklistListCommand();
            cmd.Order = order;
            cmd.Uid = uid;
            cmd.ColumnOrder = columnOrder;
            var app = (IchecklistServices)this.service;
            var response = app.Parent(cmd);
            return this.Response(response);
        }

    }
}
